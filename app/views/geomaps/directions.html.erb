<script src="//maps.google.com/maps/api/js?key=AIzaSyBqCYFsvqoNiLgEDx1k0z7x7FNEaeThT3c"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<h2>Directions</h2>

<!-- Display Map -->
<div style='width: 800px;'>
    <div id="directions" style='width: 800px; height: 400px;'></div>
</div>
<% response = Yelp.client.search('Coquitlam') %>
<% @num = response.businesses.length %>
<% @rand = Random.new.rand(1..@num) %>
<% @name = response.businesses[@rand].name %>
 <%   @lat = response.businesses[@rand].location.coordinate.latitude %>
  <%  @long = response.businesses[@rand].location.coordinate.longitude%>
<%= @num %>

<p id="test">
  Your Restaurant is <%= @name %>
</p>

<script type="text/javascript">
var directionsDisplay = new google.maps.DirectionsRenderer();
var directionsService = new google.maps.DirectionsService();
var x = document.getElementById("test");
var lat;
var long;
var destlat = <%= @lat %>;
var destlong = <%= @long %>;

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(calcRoute);
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}


function calcRoute(position) {
  var origin      = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);

  var destination = new google.maps.LatLng(destlat, destlong);

  var request = {
      origin:      origin,
      destination: destination,
      travelMode:  google.maps.TravelMode.DRIVING
  };

  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });
}

getLocation();

var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'directions'}}, function(){
  directionsDisplay.setMap(handler.getMap());
});
</script>


<script>
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
</script>

<br />
<%= link_to 'Back', geomap_index_path %>

